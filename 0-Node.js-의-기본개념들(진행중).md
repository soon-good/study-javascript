# Node.js의 기본적인 개념들



## 비동기적 이벤트

> 물론 아직 이해가 안되는 부분이 있다. 싱글 스레드 기반인데, 어떻게 각 작업을 스레드로 풀지 않고 어떤 방식으로 비동기적으로 실행시키는 것일까? 하는 궁금증이 있다. 이벤트 큐에 넣어둔다고 해도 그 이벤트를 실행하는것은 각각의 스레드이지 않나 하고 갑자기 무한 사색모드에 빠졌었다. 각각을 라운드로빈 방식으로 시분할로 동일한 시간을 부여해서 실행하게끔 큐를 관리하는 것인지 등등 내부 원리는 Node.js 관련 문서나 해외 youtube를 보면 궁금증이 해결되려나.... <br>
>
> 하지만 공부를 하거나, 실습을 하거나, Node.js 에서 제공하는 예제를 이해하는 것은 비동기적 이벤트를 실행하는 코드는 이렇게 이벤트 큐에 들어가서 하나씩 비동기적으로 실행되요. 하는 코드를 작성하는 법을 이해하는 것 같다는 기분이 들었었다.<br>
>
> Node.js 내부의 실제 원리는 Node.js 관련 해외 자료를 자세히 읽어봐야 알게 되겠다 싶었다.<br>
>
> 그래서 나중에 뭔가 이해하게 되면 이 글에 다시 와서 정리해야 할 것 같다.<br>

<br>

멀티 스레드로 여러개의 요청을 처리하지 않는다. Node.js 는 싱글스레드 기반이다. 멀티 스레드 기반 프레임워크가 아니기 때문에 각 작업을 이벤트 큐에 넣어두고 먼저 끝나는 작업을 우선적으로 실행한다.<br>

이해하기가 쉽지 않다. 일단 아래와 같이 3가지의 작업이 있다고 예를 들어보자

- 물을 끓인다. (3분)
- 스프를 넣는다. (30초)
- 면을 끓인다.(5분)

이렇게 세가지의 작업이 있을 때 Node.js 는 위의 세가지 작업이 실행되었을 때 일단 먼저 이벤트 큐에 넣어둔다.<br>

그리고 먼저 끝나는 요청을 우선적으로 끄집어 내어 결과적으로 `스프 넣는 작업`  -> `물 끓이는 작업` -> `면을 끓이는 작업` 순서로 이벤트 큐에서 나오게 된다.<br>

싱글스레드를 사용하기 때문에 멀티스레드를 사용하는 다른 프레임워크 처럼 한 스레드에서 예외가 발생할 때 다른 스레드에 문제가 되지 않는다. <br>

이렇게 이벤트 큐에 넣고 이벤트를 처리하면서 먼저 완료되는 요청부터 처리하는 방식을 비동기적 이벤트 주도 방식이라고 부른다.<br>

<br>

## 논블로킹 I/O 모델

비동기적 이벤트는 논블로킹 I/O 모델에서 작동한다.<br>

I/O 모델은 I/O bound 를 처리하는 모델을 이야기하는데, 파일시스템, 네트워크, 데이터베이스 작업을 예로 들 수 있다. <br>

논블로킹 I/O 모델은 요청을 처리하는 동안 다른 작업을 블로킹 하는 행위가 벌어지지 않는 것을 의미한다.<br>

예를 들면 아래와 같다. Node.js 의 [blocking vs non blocking](https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#comparing-code) 이라는 글에서 가져온 예제다.<br>

아래는 동기적으로 파일을 읽어들이는 예제다.

```javascript
const fs = require('fs');
const data = fs.readFileSync('/file.md'); // blocks here until file is read
```

<br>

아래는 비동기적으로 파일을 읽어들이는 예제다.

```javascript
const fs = require('fs');
fs.readFile('/file.md', (err, data) => {
  if (err) throw err;
});
```

<br>

첫 번째 예제는 두번째 예제보다 단순해보인다. 하지만, 단점이 있다. 두 번째 줄에서 다른 javascript 의 실행을 블록하고 있는다는 단점이 있다. 파일을 모두 읽어들이기 전까지 부가적인 다른 javascript 코드들이 멈춰야만한다.<br>

동기 버전 예제는 주의할 것이 예외가 발생할 경우 trhown 되어야 하고, 또는 그렇지 않으면, 프로세스가 죽게 된다.<br>

두 번째 예제는 비동기 버전이다. 일단, 에러가 발생했을 때 해당 파일을 읽어들이는 함수의 콜백에서 에러 처리 구문을 작성할 수 있다. 그리고 비동기적으로 파일을 읽어들이기에 다른 작업들에 방해를 일으키지는 않는다.<br>

<br>

